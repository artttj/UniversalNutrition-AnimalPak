#!/bin/bash
set -e

cd $(dirname $0)
BIN_DIR=$(pwd)
COMPOSE_DIR=${BIN_DIR}/../..
CICD_DIR=${BIN_DIR}/../../cicd
cd "${COMPOSE_DIR}/"

export COMPOSE_HTTP_TIMEOUT=300

if ! (ls compose/files/db/*.sql >/dev/null 2>&1 || ls compose/files/db/*.gz >/dev/null 2>&1); then
  $CICD_DIR/get-db.sh
fi

COMPOSE_ARGS="-f docker-compose.yml -f docker-compose-dev.yml"
for arg in "$@"
do
  case $arg in
    -h|--help)
      echo "Supported arguments:"
      echo "  --enable-cron      Enable php cronjob container"
      exit
      ;;
    --enable-cron)
      COMPOSE_ARGS="${COMPOSE_ARGS} -f docker-compose-cron.yml"
    esac
done

docker-compose ${COMPOSE_ARGS} up -d
